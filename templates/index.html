<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <title>Document</title>
</head>

<body>
  <div class="container">
    <form action="/submit" method="post">
      <div class="mb-3">
        <form action="/invoke-function" method="post">
          <select id="myDropdown" name="users" title="Selecione um utilizador" class="form-select"
            onchange=fillReviews()>

            {% for user in users %}
            <option id="userOp" value="{{ user }}">{{ user }}</option>
            {% endfor %}
          </select>
        </form>
      </div>
      <div>
        <textarea id="box" readonly>{{ allReviews }}</textarea>
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
    integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"
    integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
    crossorigin="anonymous"></script>
  <script type="text/javascript">
    var myUsers;
    function getStatus() {
      console.log('Getting status');
      $.ajax({
        url: '/users',
        type: 'POST',
        success: function (response) {
          myUsers = response
          console.log(response)
          populateDropdown(response);

        },
        error: function () {
          console.log('Failed to get status');
        }
      });
    }
    getStatus();

    function populateDropdown(data) {
      var dropdown = $('#myDropdown');

      // Clear any existing options
      dropdown.empty();

      // Check if data is an array
      if (Array.isArray(data)) {
        // Iterate over the array and create options
        $.each(data, function (index, item) {
          dropdown.append($('<option></option>').val(item).text(item));
        });
      } else {
        console.log('Invalid data format');
      }
    }

    function fillReviews() {
      var selectedUser = {
        "selected_user":$("#myDropdown option:selected").val()
      };
      $.ajax({
        url: "/invoke-function",
        type: "POST",
        data: selectedUser,
        success: function (response) {
          // Handle the response data here
          console.log(response.users);
          console.log(response.allReviews);
          $("#box").val(response)
        },
        error: function (error) {
          // Handle any errors that occur during the request
          console.error("Error:", error);
        }


      });

    }
  </script>
</body>

</html>